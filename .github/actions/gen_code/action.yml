name: Gen code
description: 'Generate code for the given public headers'

inputs:
  code_gen_public_headers:
    description: 'The public headers to generate, e.g. rtc_4.5.0, leave empty will use the same as the target branch'
    required: false
    default: ''

  flutter_channel:
    description: 'Target Flutter channel, e.g. stable(default), beta, dev, master (or main), or any other channel name'
    required: false
    default: 'stable'

  flutter_version:
    description: 'Target Flutter version, e.g. 3.24.5, 3.24.x, commit hash, or leave empty to use the latest release version of specified channel by flutter_version(default)'
    required: false
    # we should use the latest stable version for building example later, however, the android build will fail with the latest stable version, so we fixed use the 3.24.5 version here for now
    # Here is the error log:
    # Caused by: org.gradle.api.GradleException: You are applying Flutter's app_plugin_loader Gradle plugin imperatively using the apply script method, which is not possible anymore. Migrate to applying Gradle plugins with the declarative plugins block: https://flutter.dev/to/flutter-gradle-plugin-apply
    default: '3.24.5'

  working_directory:
    description: 'The working directory of the action'
    required: false
    default: './'

runs:
  using: composite
  steps:
    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: ${{ inputs.flutter_channel }}
        flutter-version: ${{ inputs.flutter_version }}

    - name: Gen
      uses: AgoraIO-Extensions/actions/.github/actions/generate@main
      with:
        generate-code: true
        generate-comment: false
        working-directory: ${{ inputs.working_directory }}
        generate-code-command: |
          corepack enable && bash scripts/code_gen.sh ${{ inputs.code_gen_public_headers }}
        generate-comment-command: ""
        github-token: ""

